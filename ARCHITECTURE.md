# AI Agent MCP å¾…åŠäº‹é¡¹åº”ç”¨ - Pythonè°ƒç”¨å…³ç³»åˆ†æ

## ğŸ—ï¸ æ•´ä½“æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·äº¤äº’å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  main.py (CLIç•Œé¢)           demo.py (æ¼”ç¤ºè„šæœ¬)                      â”‚
â”‚  â””â”€ TodoApp                  â””â”€ æ¼”ç¤ºå‡½æ•°                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ è°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AI ä»£ç†å±‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ai_agent.py                enhanced_ai_agent.py (å¢å¼ºç‰ˆ)            â”‚
â”‚  â””â”€ AIAgent                 â””â”€ EnhancedAIAgent                       â”‚
â”‚     â”œâ”€ process_user_input       â”œâ”€ analyze_user_intent                â”‚
â”‚     â”œâ”€ call_azure_openai        â”œâ”€ extract_parameters                 â”‚
â”‚     â””â”€ execute_function_call    â””â”€ process_user_input_with_intent     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                              â”‚
            è°ƒç”¨Azure OpenAI                   è°ƒç”¨MCPæœåŠ¡å™¨
                    â”‚                              â”‚
                    â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Azure OpenAI                        MCP æœåŠ¡å™¨å±‚                      â”‚
â”‚ GPT-4.1 æ¨¡å‹                                                          â”‚
â”‚ Function Calling                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ HTTP APIè°ƒç”¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MCP HTTP æœåŠ¡å™¨                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  mcp_server.py                                                        â”‚
â”‚  â””â”€ FastAPI åº”ç”¨                                                      â”‚
â”‚     â”œâ”€ handle_mcp_request (POST /mcp)                                â”‚
â”‚     â””â”€ health_check (GET /health)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ è°ƒç”¨æ•°æ®åº“ç®¡ç†å™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®è®¿é—®å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  database.py              models.py                                   â”‚
â”‚  â””â”€ DatabaseManager       â””â”€ æ•°æ®æ¨¡å‹                                 â”‚
â”‚     â”œâ”€ create_todo           â”œâ”€ Todo                                  â”‚
â”‚     â”œâ”€ get_todos            â”œâ”€ TodoCreate                            â”‚
â”‚     â”œâ”€ update_todo          â”œâ”€ TodoUpdate                            â”‚
â”‚     â”œâ”€ delete_todo          â”œâ”€ MCPRequest                            â”‚
â”‚     â””â”€ search_todos         â””â”€ MCPResponse                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ SQLæŸ¥è¯¢
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®å­˜å‚¨å±‚                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL æ•°æ®åº“ (Dockerå®¹å™¨)                                       â”‚
â”‚  â””â”€ todos è¡¨                                                          â”‚
â”‚     â”œâ”€ id (ä¸»é”®)                                                      â”‚
â”‚     â”œâ”€ title (æ ‡é¢˜)                                                   â”‚
â”‚     â”œâ”€ content (å†…å®¹)                                                 â”‚
â”‚     â”œâ”€ due_date (æˆªæ­¢æ—¥æœŸ)                                            â”‚
â”‚     â”œâ”€ completed (å®ŒæˆçŠ¶æ€)                                           â”‚
â”‚     â”œâ”€ created_at (åˆ›å»ºæ—¶é—´)                                          â”‚
â”‚     â””â”€ updated_at (æ›´æ–°æ—¶é—´)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ–‡ä»¶è¯¦ç»†è°ƒç”¨å…³ç³»

### 1. **main.py** (ä¸»å…¥å£ç‚¹)
```python
main.py
â”œâ”€ å¯¼å…¥ï¼šai_agent.AIAgent
â”œâ”€ å¯¼å…¥ï¼štyper, rich (UIåº“)
â””â”€ ç±»ï¼šTodoApp
   â”œâ”€ __init__(): åˆ›å»º AIAgent å®ä¾‹
   â”œâ”€ run_interactive(): äº¤äº’å¼å¾ªç¯
   â””â”€ è°ƒç”¨ï¼šagent.process_user_input(user_input)
```

**ä½œç”¨**: CLIç”¨æˆ·ç•Œé¢ï¼Œå¤„ç†ç”¨æˆ·äº¤äº’

### 2. **ai_agent.py** (AIä»£ç†æ ¸å¿ƒ)
```python
ai_agent.py
â”œâ”€ å¯¼å…¥ï¼šhttpx, json, os
â”œâ”€ å¯¼å…¥ï¼šdotenv (ç¯å¢ƒå˜é‡)
â””â”€ ç±»ï¼šAIAgent
   â”œâ”€ __init__(): åˆå§‹åŒ–Azure OpenAIé…ç½®å’Œå·¥å…·å®šä¹‰
   â”œâ”€ call_azure_openai(): è°ƒç”¨Azure OpenAI API
   â”œâ”€ call_mcp_server(): HTTPè°ƒç”¨MCPæœåŠ¡å™¨
   â”œâ”€ execute_function_call(): æ‰§è¡Œå‡½æ•°è°ƒç”¨
   â””â”€ process_user_input(): ä¸»å¤„ç†é€»è¾‘
      â”œâ”€ æ„å»ºæ¶ˆæ¯ â†’ Azure OpenAI
      â”œâ”€ è§£ætool_calls â†’ function_name + arguments
      â””â”€ è°ƒç”¨ execute_function_call()
```

**ä½œç”¨**: AIæ™ºèƒ½ä»£ç†ï¼Œåè°ƒç”¨æˆ·è¾“å…¥ã€AIå†³ç­–å’Œå‡½æ•°æ‰§è¡Œ

### 3. **mcp_server.py** (MCP HTTPæœåŠ¡å™¨)
```python
mcp_server.py
â”œâ”€ å¯¼å…¥ï¼šFastAPI, HTTPException
â”œâ”€ å¯¼å…¥ï¼šmodels.*, database.DatabaseManager
â””â”€ FastAPIåº”ç”¨
   â”œâ”€ POST /mcp: handle_mcp_request()
   â”‚  â”œâ”€ è§£æMCPRequest
   â”‚  â”œâ”€ æ ¹æ®methodè°ƒç”¨DatabaseManageræ–¹æ³•
   â”‚  â””â”€ è¿”å›MCPResponse
   â””â”€ GET /health: health_check()
      â””â”€ æµ‹è¯•æ•°æ®åº“è¿æ¥
```

**ä½œç”¨**: MCPåè®®HTTPæœåŠ¡å™¨ï¼Œæä¾›RESTful APIæ¥å£

### 4. **database.py** (æ•°æ®åº“ç®¡ç†å™¨)
```python
database.py
â”œâ”€ å¯¼å…¥ï¼špsycopg2, psycopg2.extras
â”œâ”€ å¯¼å…¥ï¼šmodels.Todo, TodoCreate, TodoUpdate
â””â”€ ç±»ï¼šDatabaseManager
   â”œâ”€ __init__(): è¯»å–æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
   â”œâ”€ get_connection(): åˆ›å»ºPostgreSQLè¿æ¥
   â”œâ”€ create_todo(TodoCreate) â†’ Todo
   â”œâ”€ get_todos(completed?) â†’ List[Todo]
   â”œâ”€ get_todo_by_id(id) â†’ Todo?
   â”œâ”€ update_todo(id, TodoUpdate) â†’ Todo?
   â”œâ”€ delete_todo(id) â†’ bool
   â””â”€ search_todos(query) â†’ List[Todo]
```

**ä½œç”¨**: æ•°æ®è®¿é—®å±‚ï¼Œå°è£…æ‰€æœ‰æ•°æ®åº“æ“ä½œ

### 5. **models.py** (æ•°æ®æ¨¡å‹)
```python
models.py
â”œâ”€ å¯¼å…¥ï¼špydantic.BaseModel
â”œâ”€ å¯¼å…¥ï¼štyping, datetime
â””â”€ æ•°æ®æ¨¡å‹
   â”œâ”€ TodoBase: åŸºç¡€å¾…åŠäº‹é¡¹å­—æ®µ
   â”œâ”€ TodoCreate: åˆ›å»ºå¾…åŠäº‹é¡¹è¯·æ±‚
   â”œâ”€ TodoUpdate: æ›´æ–°å¾…åŠäº‹é¡¹è¯·æ±‚
   â”œâ”€ Todo: å®Œæ•´çš„å¾…åŠäº‹é¡¹æ¨¡å‹
   â”œâ”€ MCPRequest: MCPè¯·æ±‚æ ¼å¼
   â””â”€ MCPResponse: MCPå“åº”æ ¼å¼
```

**ä½œç”¨**: æ•°æ®æ¨¡å‹å®šä¹‰ï¼Œç±»å‹éªŒè¯å’Œåºåˆ—åŒ–

### 6. **demo.py** (æ¼”ç¤ºè„šæœ¬)
```python
demo.py
â”œâ”€ å¯¼å…¥ï¼šai_agent.AIAgent
â””â”€ æ¼”ç¤ºå‡½æ•°
   â”œâ”€ åˆ›å»ºAIAgentå®ä¾‹
   â”œâ”€ æ¨¡æ‹Ÿç”¨æˆ·è¾“å…¥
   â””â”€ è°ƒç”¨agent.process_user_input()
```

**ä½œç”¨**: åŠŸèƒ½æ¼”ç¤ºå’Œæµ‹è¯•

## ğŸ”„ å…¸å‹è°ƒç”¨æµç¨‹

### ç”¨æˆ·åˆ›å»ºå¾…åŠäº‹é¡¹çš„å®Œæ•´æµç¨‹ï¼š

```
1. ç”¨æˆ·è¾“å…¥: "åˆ›å»ºä¸€ä¸ªä»»åŠ¡ï¼šå­¦ä¹ Python"
   â†“
2. main.py â†’ TodoApp.run_interactive()
   â†“
3. ai_agent.py â†’ AIAgent.process_user_input()
   â”œâ”€ æ„å»ºæ¶ˆæ¯å‘é€ç»™Azure OpenAI
   â”œâ”€ GPT-4.1åˆ†æç”¨æˆ·æ„å›¾ï¼Œé€‰æ‹©create_todoå‡½æ•°
   â”œâ”€ æå–å‚æ•°: {"title": "å­¦ä¹ Python"}
   â””â”€ è°ƒç”¨execute_function_call("create_todo", params)
   â†“
4. ai_agent.py â†’ AIAgent.call_mcp_server()
   â”œâ”€ HTTP POST to localhost:8000/mcp
   â”œâ”€ è¯·æ±‚ä½“: {"method": "create_todo", "params": {"title": "å­¦ä¹ Python"}}
   â†“
5. mcp_server.py â†’ handle_mcp_request()
   â”œâ”€ è§£æMCPRequest
   â”œâ”€ åˆ›å»ºTodoCreateå¯¹è±¡
   â””â”€ è°ƒç”¨db.create_todo(todo_data)
   â†“
6. database.py â†’ DatabaseManager.create_todo()
   â”œâ”€ å»ºç«‹PostgreSQLè¿æ¥
   â”œâ”€ æ‰§è¡ŒINSERT SQLè¯­å¥
   â””â”€ è¿”å›æ–°åˆ›å»ºçš„Todoå¯¹è±¡
   â†“
7. å“åº”è¿”å›è·¯å¾„ (é€†å‘)
   database.py â†’ mcp_server.py â†’ ai_agent.py â†’ main.py â†’ ç”¨æˆ·
```

## ğŸ§© å…³é”®è®¾è®¡æ¨¡å¼

### 1. **åˆ†å±‚æ¶æ„æ¨¡å¼**
- **è¡¨ç°å±‚**: main.py (CLIç•Œé¢)
- **ä¸šåŠ¡é€»è¾‘å±‚**: ai_agent.py (AIå¤„ç†)
- **æœåŠ¡å±‚**: mcp_server.py (APIæœåŠ¡)
- **æ•°æ®è®¿é—®å±‚**: database.py (æ•°æ®åº“æ“ä½œ)
- **æ•°æ®æ¨¡å‹å±‚**: models.py (æ•°æ®ç»“æ„)

### 2. **ä»£ç†æ¨¡å¼**
- `AIAgent`ä½œä¸ºç”¨æˆ·å’Œå„ç§æœåŠ¡ä¹‹é—´çš„ä»£ç†
- åè°ƒAzure OpenAIã€MCPæœåŠ¡å™¨çš„è°ƒç”¨

### 3. **å·¥å‚æ¨¡å¼**
- `DatabaseManager`æ ¹æ®ç¯å¢ƒå˜é‡åˆ›å»ºæ•°æ®åº“è¿æ¥
- æ¨¡å‹ç±»æ ¹æ®è¾“å…¥æ•°æ®åˆ›å»ºå¯¹è±¡å®ä¾‹

### 4. **ç­–ç•¥æ¨¡å¼**
- `enhanced_ai_agent.py`æä¾›äº†ä¸¤ç§functioné€‰æ‹©ç­–ç•¥ï¼š
  - åŸºäºè§„åˆ™çš„æ„å›¾åˆ†æ
  - åŸºäºAIæ¨¡å‹çš„æ™ºèƒ½é€‰æ‹©

## ğŸ”§ ä¾èµ–å…³ç³»æ€»ç»“

```
main.py
â””â”€ ai_agent.py
   â”œâ”€ httpx (HTTPå®¢æˆ·ç«¯)
   â”œâ”€ Azure OpenAI API
   â””â”€ MCP Server (localhost:8000)

mcp_server.py
â”œâ”€ FastAPI (Webæ¡†æ¶)
â”œâ”€ models.py
â””â”€ database.py
   â”œâ”€ psycopg2 (PostgreSQLé©±åŠ¨)
   â”œâ”€ models.py
   â””â”€ PostgreSQLæ•°æ®åº“

models.py
â””â”€ pydantic (æ•°æ®éªŒè¯)

demo.py
â””â”€ ai_agent.py
```

## ğŸ’¡ æ¶æ„ä¼˜åŠ¿

1. **æ¾è€¦åˆ**: æ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€ï¼Œä¾¿äºç»´æŠ¤å’Œæµ‹è¯•
2. **å¯æ‰©å±•**: å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„åŠŸèƒ½æˆ–æ›¿æ¢ç»„ä»¶
3. **æ ‡å‡†åŒ–**: ä½¿ç”¨MCPåè®®ï¼Œç¬¦åˆè¡Œä¸šæ ‡å‡†
4. **å®¹é”™æ€§**: æ¯å±‚éƒ½æœ‰é”™è¯¯å¤„ç†æœºåˆ¶
5. **å¯æµ‹è¯•**: æ¨¡å—åŒ–è®¾è®¡ä¾¿äºå•å…ƒæµ‹è¯•

è¿™ä¸ªæ¶æ„ä½“ç°äº†ç°ä»£è½¯ä»¶å¼€å‘çš„æœ€ä½³å®è·µï¼Œå°†AIèƒ½åŠ›ã€WebæœåŠ¡ã€æ•°æ®åº“æ“ä½œæœ‰æœºç»“åˆåœ¨ä¸€èµ·ã€‚
